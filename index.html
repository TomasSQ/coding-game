<html>
	<head>
		<script
	src="http://code.jquery.com/jquery-3.2.1.min.js"
	integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css">
		<link rel="stylesheet" href="https://codemirror.net/addon/hint/show-hint.css">
		<link rel="stylesheet" href="https://codemirror.net/theme/pastel-on-dark.css">
		<script type="text/javascript" src="https://codemirror.net/lib/codemirror.js"></script>
		<script type="text/javascript" src="https://codemirror.net/addon/hint/show-hint.js"></script>
		<script type="text/javascript" src="https://codemirror.net/addon/hint/javascript-hint.js"></script>
		<script type="text/javascript" src="https://codemirror.net/mode/javascript/javascript.js"></script>
		<script type="text/javascript" src="https://codemirror.net/mode/markdown/markdown.js"></script>
		<style>
			body {
				margin: 0;
				padding: 0;
				width: 100vw;
			}
			.canvas {
				position: relative;
				height: 100vh;
				width: 50%;
				background-color: rgb(240,240,240);
				display: inline-block;
				vertical-align: top;
			}
			.character {
				width: 10px;
				height: 10px;
				position: absolute;
			}

			.player {
				background-color: blue;
			}

			.enemy {
				background-color: red;
			}

			.right-side {
				width: 50%;
				display: inline-block;
				height: 100vh;
				vertical-align: top;
			}
			textarea {
				width: 500px;
				height: 100px;
			}
			button {
				background: white;
				border: 1px solid black;
				text-align: center;
				width: 100%;
			}
		</style>

	</head>
	<body>
		<div class="canvas">
			<div class="character player"></div>
			<div class="shot shot-player" style="display: none;"></div>
			<div class="character enemy"></div>
			<div class="shot shot-enemy" style="display: none;"></div>
		</div><div class="right-side">
			<textarea id="code">lib.enemy.walk('LEFT')</textarea>
			<button>exec</button>
		</div>
		<script src="js/tsp.js"></script>
		<script>
			(function() {
				let ended = false;
				let d 
				const execCode = (code) => {
					setInterval( () => {
						execRound(code)
					}, 1000)
				}
				const execRound = (code) => {
					if (ended) {
						alert('acaboouu')
						return;
					}
					eval('(function(lib){'+$('textarea').val()+'})(window.lib)')
					d = setTimeout(() => execRound(code), 1000)
				}
				$('button').click(() => {
					if (d) clearInterval(d)
					execRound($('textarea').val())
				})

				window.lib.redraw()
			})()
		</script>
		<script type="text/javascript" src="js/code-editor.js"></script>
	</body>
</html>
